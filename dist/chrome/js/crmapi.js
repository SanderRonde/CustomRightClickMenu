/*!
 * Original can be found at https://github.com/SanderRonde/CustomRightClickMenu 
 * This code may only be used under the MIT style license found in the LICENSE.txt file 
**/
var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},__decorate=this&&this.__decorate||function(e,t,n,r){var s,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;0<=o;o--)(s=e[o])&&(a=(i<3?s(a):3<i?s(t,n,a):s(t,n))||a);return 3<i&&a&&Object.defineProperty(t,n,a),a};!function(k){var m={};try{Object.defineProperty(k,"localStorageProxy",{get:function(){return m}})}catch(e){}Object.defineProperty(m,"getItem",{get:function(){return function(e){return localStorage[e]}}});var y={onSet:function(e,t){}};Object.defineProperty(m,"setItem",{get:function(){return y.onSet}}),Object.defineProperty(m,"clear",{get:function(){return function(){}}});var t=function(){function e(){this._store=[]}return e.prototype.set=function(e,t){this._store.push([e,t])},e.prototype.get=function(e){for(var t=0,n=this._store;t<n.length;t++){var r=n[t],s=r[0],i=r[1];if(e===s)return i}return null},e}();function I(r,s,e){var t=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.apply(s.get(this)||this,e)},n=function(n){"function"==typeof r[n]?(t[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r[n].apply(s.get(this)||this,e)},-1===e.indexOf(t)&&e.push(t)):t[n]=r[n]};for(var i in r)n(i);return t.prototype=r.prototype,t}function n(e){var m=new t,y=e.prototype,b=[];return function(v){function e(e,t,n,r,s,i,a,o,c,_,u,l,p,d,h){var f=v.call(this,e,t,n,r,s,i,a,o,c,_,u,l,p,d,h)||this;!function e(t,n,r){var s=void 0===k?self:k,i=!1;for(var a in t){i||(i=!0,-1===r.indexOf(t)&&r.push(t));var o=t[a];if(o!==s&&o&&"_chromeRequest"!==a)switch(typeof o){case"function":t[a]=I(o,n,r);break;case"object":var c=k.HTMLElement;c&&o instanceof c?t[a]=o:e(o,n,r)}}}(f,m,b);var g=function(n,e){var r={},s={},t=function(t){-1===e.indexOf(t)?Object.defineProperty(s,t,{get:function(){return n[t]},set:function(e){n[t]=e}}):(Object.defineProperty(s,t,{get:function(){return r[t]},set:function(e){r[t]=e}}),r[t]=n[t])};for(var i in n)t(i);return s}(f,y.__privates__);return m.set(f,g),m.set(g,g),b.forEach(function(e){m.set(e,g)}),function(e,t){for(var n=0,r=t;n<r.length;n++)e[r[n]]=void 0}(f,y.__privates__),f._init(u),f}return __extends(e,v),e}(e)}function r(e,t){e.__privates__=(e.__privates__||[]).concat([t])}var e=function(){function e(e,t,n,r,s,i,a,o,c,_,u,l,p,d,h){var f=this;this.__privates={_node:null,_id:null,_tabData:null,_clickData:null,_secretKey:null,_nodeStorage:null,_nodeStorageSync:null,_contextData:null,_greasemonkeyData:null,_isBackground:null,_options:null,_enableBackwardsCompatibility:null,_tabIndex:null,_instanceId:null,_extensionId:null,_supportedAPIs:null,_sendMessage:null,_queue:[],_port:{postMessage:null,onMessage:{addListener:null}},_findElementsOnPage:function(e){if(void 0!==k.document&&e){var t="crm_element_identifier_"+e.target,n="crm_element_identifier_"+e.toElement,r="crm_element_identifier_"+e.srcElement;this.contextData={target:k.document.querySelector("."+t),toElement:k.document.querySelector("."+n),srcElement:k.document.querySelector("."+r)},this.contextData.target&&this.contextData.target.classList.remove(t),this.contextData.toElement&&this.contextData.toElement.classList.remove(n),this.contextData.srcElement&&this.contextData.srcElement.classList.remove(r)}else this.contextData={target:null,toElement:null,srcElement:null}},_setupBrowserAPI:function(e){var t=this,n={addListener:function(){},removeListener:function(){}};e.browser=__assign({},this._wrapBrowserObject({alarms:{create:function(){},get:function(){},getAll:function(){},clear:function(){},clearAll:function(){},onAlarm:n},bookmarks:{create:function(){},get:function(){},getChildren:function(){},getRecent:function(){},getSubTree:function(){},getTree:function(){},move:function(){},remove:function(){},removeTree:function(){},search:function(){},update:function(){},onCreated:n,onRemoved:n,onChanged:n,onMoved:n},browserAction:{setTitle:function(){},getTitle:function(){},setIcon:function(){},setPopup:function(){},getPopup:function(){},openPopup:function(){},setBadgeText:function(){},getBadgeText:function(){},setBadgeBackgroundColor:function(){},getBadgeBackgroundColor:function(){},enable:function(){},disable:function(){},onClicked:n},browsingData:{remove:function(){},removeCache:function(){},removeCookies:function(){},removeDownloads:function(){},removeFormData:function(){},removeHistory:function(){},removePasswords:function(){},removePluginData:function(){},settings:function(){}},commands:{getAll:function(){},onCommand:n},contextMenus:{create:function(){},update:function(){},remove:function(){},removeAll:function(){},onClicked:n},contextualIdentities:{create:function(){},get:function(){},query:function(){},update:function(){},remove:function(){}},cookies:{get:function(){},getAll:function(){},set:function(){},remove:function(){},getAllCookieStores:function(){},onChanged:n},devtools:{inspectedWindow:{eval:function(){},reload:function(){}},network:{onNavigated:n},panels:{create:function(){}}},downloads:{download:function(){},search:function(){},pause:function(){},resume:function(){},cancel:function(){},open:function(){},show:function(){},showDefaultFolder:function(){},erase:function(){},removeFile:function(){},onCreated:n,onErased:n,onChanged:n},extension:{getURL:function(){},getViews:function(){},getBackgroundPage:function(){},isAllowedIncognitoAccess:function(){},isAllowedFileSchemeAccess:function(){}},history:{search:function(){},getVisits:function(){},addUrl:function(){},deleteUrl:function(){},deleteRange:function(){},deleteAll:function(){},onVisited:n,onVisitRemoved:n},i18n:{getAcceptLanguage:function(){},getMessage:function(){},getUILanguage:function(){},detectLanguage:function(){}},identity:{getRedirectURL:function(){},launchWebAuthFlow:function(){}},idle:{queryState:function(){},setDetectionInterval:function(){},onStateChanged:n},management:{getSelf:function(){},uninstallSelf:function(){}},notifications:{create:function(){},clear:function(){},getAll:function(){},onClicked:n,onClosed:n},omnibox:{setDefaultSuggestion:function(){},onInputStarted:n,onInputChanged:n,onInputEntered:n,onInputCancelled:n},pageAction:{show:function(){},hide:function(){},setTitle:function(){},getTitle:function(){},setIcon:function(){},setPopup:function(){},getPopup:function(){},onClicked:n},permissions:{contains:function(){},getAll:function(){},request:function(){},remove:function(){}},runtime:{setUninstallURL:function(){},connectNative:function(){},sendNativeMessage:function(){},getBrowserInfo:function(){},connect:function(){},getBackgroundPage:function(){},getManifest:function(){},getURL:function(){},getPlatformInfo:function(){},openOptionsPage:function(){},reload:function(){},sendMessage:function(){},onStartup:n,onUpdateAvailable:n,onInstalled:n,onConnectExternal:n,onConnect:n,onMessage:n,onMessageExternal:n,lastError:void 0,id:null},sessions:{getRecentlyClosed:function(){},restore:function(){},setTabValue:function(){},getTabValue:function(){},removeTabValue:function(){},setWindowValue:function(){},getWindowValue:function(){},removeWindowValue:function(){},onChanged:n},sidebarAction:{setPanel:function(){},getPanel:function(){},setTitle:function(){},getTitle:function(){},setIcon:function(){},open:function(){},close:function(){}},storage:{local:{get:function(){},set:function(){},remove:function(){},clear:function(){}},sync:{get:function(){},set:function(){},remove:function(){},clear:function(){}},onChanged:n},tabs:{connect:function(){},detectLanguage:function(){},duplicate:function(){},getZoom:function(){},getZoomSettings:function(){},insertCSS:function(){},removeCSS:function(){},move:function(){},print:function(){},printPreview:function(){},reload:function(){},remove:function(){},saveAsPDF:function(){},setZoom:function(){},setZoomSettings:function(){},create:function(){},get:function(){},getCurrent:function(){},captureVisibleTab:function(){},update:function(){},query:function(){},executeScript:function(){},sendMessage:function(){},onActivated:n,onAttached:n,onCreated:n,onDetached:n,onMoved:n,onReplaced:n,onZoomChanged:n,onUpdated:n,onRemoved:n,onHighlighted:n},topSites:{get:function(){}},webNavigation:{getFrame:function(){},getAllFrames:function(){},onBeforeNavigate:n,onCommitted:n,onCreateNavigationTarget:n,onDOMContentLoaded:n,onCompleted:n,onErrorOccurred:n,onReferenceFragmentUpdated:n,onHistoryStateUpdated:n},webRequest:{onBeforeRequest:n,onBeforeSendHeaders:n,onSendHeaders:n,onHeadersReceived:n,onAuthRequired:n,onResponseStarted:n,onBeforeRedirect:n,onCompleted:n,onErrorOccurred:n,filterResponseData:function(){}},windows:{get:function(){},getCurrent:function(){},getLastFocused:function(){},getAll:function(){},create:function(){},update:function(){},remove:function(){},onCreated:n,onRemoved:n,onFocusChanged:n},theme:{getCurrent:function(){},update:function(){},reset:function(){}}},e),{any:function(e){return new t._browserRequest(this,e)}})},_setupStorages:function(){this.__privates._callInfo=new v._helpers.CallbackStorage,this.__privates._instances=new v._helpers.CallbackStorage,this.__privates._commListeners=new v._helpers.CallbackStorage,this.__privates._backgroundPageListeners=new v._helpers.CallbackStorage,this.__privates._storageListeners=new v._helpers.CallbackStorage},_callInfo:null,_getStackTrace:function(e){return e.stack.split("\n")},_createDeleterFunction:function(e){var t=this;return function(){t.__privates._callInfo.remove(e)}},_createCallback:function(e,t,n){var r=(n=n||{}).persistent,s=n.maxCalls||1;t=t||new Error;var i=this.__privates._callInfo.add({callback:e,stackTrace:this.stackTraces&&this.__privates._getStackTrace(t),persistent:r,maxCalls:s});return r||setTimeout(this.__privates._createDeleterFunction(i),36e5),i},_createCallbackFunction:function(r,e,t){var s=this;return this.__privates._createCallback(function(e,t,n){if("error"===e){if(s.onError&&s.onError(t),s.stackTraces&&setTimeout(function(){console.log("stack trace: "),n.forEach(function(e){console.log(e)})},5),s.errors)throw new Error("CrmAPIError: "+t.error);console.warn("CrmAPIError: "+t.error)}else r.apply(s,t)},e,t)},_handshakeFunction:function(){var t=this;this.__privates._sendMessage=function(e){e.onFinish&&(e.onFinish=t.__privates._createCallback(e.onFinish.fn,new Error,{maxCalls:e.onFinish.maxCalls,persistent:e.onFinish.persistent})),t.__privates._port.postMessage(e)},this.__privates._queue.forEach(function(e){t.__privates._sendMessage(e)}),this.__privates._queue=null},_lastError:null,_callbackHandler:function(e){var t=this.__privates._callInfo.get(e.callbackId);if(t){if(e.data&&e.data.lastError&&(this.__privates._lastError={checked:!1,err:e.data.lastError}),t.callback(e.type,e.data,t.stackTrace),e.data&&e.data.lastError){if(!this.__privates._lastError.checked){if(!this.onError)throw new Error("Unchecked lastError");this.onError({error:"Unchecked lastError",message:"Unchecked lastError",lineNumber:0,stackTrace:t.stackTrace&&t.stackTrace.join("\n")||""})}this.__privates._lastError=void 0}t.persistent||(t.maxCalls--,0===t.maxCalls&&this.__privates._callInfo.remove(e.callbackId))}},_executeCode:function(e){var t,n=(new Date).toLocaleString(),r=(new Error).stack.split("\n")[1];-1<r.indexOf("eval")&&(r=(new Error).stack.split("\n")[2]);try{var s=this.__privates._isBackground?self:k;t={type:"success",result:JSON.stringify(v._helpers.specialJSON.toJSON.apply(v._helpers.specialJSON,[eval.apply(s,[e.code])]))}}catch(e){t={type:"error",result:{stack:e.stack,name:e.name,message:e.message}}}this.__privates._sendMessage({id:this.__privates._id,type:"logCrmAPIValue",tabId:this.__privates._tabData.id,tabIndex:this.__privates._tabIndex,data:{type:"evalResult",value:t,id:this.__privates._id,tabIndex:this.__privates._tabIndex,callbackIndex:e.logCallbackIndex,lineNumber:"<eval>:0",timestamp:n,tabId:this.__privates._tabData.id}})},_getObjectProperties:function(e){var t=Object.getOwnPropertyNames(Object.getPrototypeOf(e)),n=[];for(var r in e)n.push(r);return t.concat(n)},_leadingWordRegex:/^(\w+)/,_sectionRegex:/^((\[(['"`])(\w+)\3\])|(\.(\w+)))/,_endRegex:/^(\.(\w+)?|\[((['"`])((\w+)(\11)?)?)?)?/,_getCodeSections:function(e){var t=this.__privates._leadingWordRegex.exec(e)[1];e=e.slice(t.length);for(var n,r=[];n=this.__privates._sectionRegex.exec(e);){var s=n[4]||n[5];r.push(s),e=e.slice(s.length)}var i=this.__privates._endRegex.exec(e),a=null;return i&&(a={type:i[3]?"brackets":"dotnotation",currentWord:i[2]||i[6]}),{lead:t,words:r,end:a}},_getSuggestions:function(e){var t=this.__privates._getCodeSections(e.code),n=t.lead,r=t.words,s=t.end;if(!s)return null;if(!(n in k))return null;var i=k[n];if(i){for(var a=0;a<r.length;a++){if(!(r[a]in i))return null;i=i[r[a]]}var o={full:[],partial:[]},c=this.__privates._getObjectProperties(i);for(a=0;a<c.length;a++)c[a]===s.currentWord?o.full.push(c[a]):0===c[a].indexOf(s.currentWord)&&o.partial.push(c[a]);return o.full.sort().concat(o.partial.sort())}return null},_getHints:function(e){var t=this.__privates._getSuggestions(e)||[];this.__privates._sendMessage({id:this.__privates._id,type:"displayHints",tabId:this.__privates._tabData.id,tabIndex:this.__privates._tabIndex,data:{hints:t,id:this.__privates._id,tabIndex:this.__privates._tabIndex,callbackIndex:e.logCallbackIndex,tabId:this.__privates._tabData.id}})},_remoteStorageChange:function(e,t){for(var n=0===t?this.__privates._nodeStorageSync:this.__privates._nodeStorage,r=0;r<e.length;r++){var s=e[r].key.split(".");this.__privates._notifyChanges(t,s,e[r].oldValue,e[r].newValue,!0),(v._helpers.lookup(s,n,!0)||{})[s[s.length-1]]=e[r].newValue,0===t?this.__privates._storagePreviousSync=n:this.__privates._storagePrevious=n}},_instancesReady:!1,_instancesReadyListeners:[],_instances:null,_instancesChange:function(n){var r=this;switch(n.type){case"removed":this.__privates._instances.forEach(function(e,t){e.id===n.value&&r.__privates._instances.remove(t)});break;case"added":this.__privates._instances.add({id:n.value,tabIndex:n.tabIndex,sendMessage:this.__privates._generateSendInstanceMessageFunction(n.value,n.tabIndex)})}},_commListeners:null,_instanceMessageHandler:function(t){this.__privates._commListeners.forEach(function(e){e&&"function"==typeof e&&e(t.message)})},_handleValueChanges:function(n,r,s,i){var a=this;return function(){if(n[2]!==r[2])switch(r[1]){case"Link":var e=r[2].split(",").map(function(e){return{url:e,newTab:!0}});a.crm.link.setLinks(s[i],e);break;case"Script":var t=r[2].split("%124");a.crm.script.setScript(s[i],t[1],function(){a.crm.setLaunchMode(s[i],~~t[0])})}}},_localStorageProxyHandler:function(u){var l=this,p=u.message.indexIds,e=function(t){if("indexIds"!==t)try{Object.defineProperty(m,t,{get:function(){return m[t]},set:function(e){y.onSet(t,e)}})}catch(e){}};for(var t in u.message)e(t);y.onSet=function(e,t){if(isNaN(parseInt(e,10)))m[e]=t,l.__privates._sendMessage({id:l.__privates._id,tabIndex:l.__privates._tabIndex,type:"applyLocalStorage",data:{tabIndex:l.__privates._tabIndex,key:e,value:t},tabId:l.__privates._tabData.id});else{var n=parseInt(e,10),r=m[e],s=t;m[e]=t;var i=r.split("%123"),a=s.split("%123");if(n>=u.message.numberofrows){var o={name:a[0],type:a[1].toLowerCase()};switch(a[1]){case"Link":o.linkData=a[2].split(",").map(function(e){return{url:e,newTab:!0}});break;case"Script":var c=a[2].split("%124");o.scriptData={launchMode:~~c[0],script:c[1]}}l.crm.createNode(o)}else{var _={};i[0]!==a[0]&&(_.name=a[0]),i[1]!==a[1]&&(_.type=a[1].toLowerCase()),_.name||_.type?l.crm.editNode(p[n],_,l.__privates._handleValueChanges(i,a,p,n)):l.__privates._handleValueChanges(i,a,p,n)()}}}},_generateBackgroundResponse:function(t){var n=this;return function(e){n.__privates._sendMessage({id:n.__privates._id,tabIndex:n.__privates._tabIndex,type:"respondToBackgroundMessage",data:{message:e,id:t.id,tabIndex:n.__privates._tabIndex,tabId:t.tabId,response:t.respond},tabId:n.__privates._tabData.id})}},_backgroundPageListeners:null,_backgroundPageMessageHandler:function(t){var n=this;this.__privates._backgroundPageListeners.forEach(function(e){e&&"function"==typeof e&&e(t.message,n.__privates._generateBackgroundResponse(t))})},_createVariable:function(e,t){var n,r=this.__privates._isBackground?self:k;for(n=1;"temp"+n in r;n++);return r["temp"+n]=e.originalValues[t],"temp"+n},_sentLogs:[null],_createLocalVariable:function(e){var t=this.__privates._sentLogs[e.code.logId],n=("["+e.code.index+"]"+e.code.path.replace(/\.(\w+)/g,function(e,t){return'["'+t+'"]'})).split("][");n[0]=n[0].slice(1),n[n.length-1]=n[n.length-1].slice(0,n[n.length-1].length-1);for(var r=JSON.stringify(n.map(function(e){return JSON.parse(e)})),s=0;s<t.logObj.paths.length;s++)if(r===JSON.stringify(t.logObj.paths[s])){var i=this.__privates._createVariable(t,s);return void this.log("Created local variable "+i)}this.log("Could not create local variable")},_messageHandler:function(e){if(this.__privates._queue){var t=e,n=t.instances,r=t.currentInstance;null===r?(this.__privates._instanceId=-1,this.instanceId=-1):(this.__privates._instanceId=r.id,this.instanceId=r.id);for(var s=0;s<n.length;s++)this.__privates._instances.add({id:n[s].id,tabIndex:n[s].tabIndex,sendMessage:this.__privates._generateSendInstanceMessageFunction(n[s].id,n[s].tabIndex)});var i=[];this.__privates._instances.forEach(function(e){i.push(e)}),this.__privates._instancesReady=!0,this.__privates._instancesReadyListeners.forEach(function(e){e(i)}),this.__privates._handshakeFunction.apply(this,[])}else switch(e.messageType){case"callback":this.__privates._callbackHandler(e);break;case"executeCRMCode":this.__privates._executeCode(e);break;case"getCRMHints":this.__privates._getHints(e);break;case"storageUpdate":this.__privates._remoteStorageChange(e.changes,e.isSync);break;case"instancesUpdate":this.__privates._instancesChange(e.change);break;case"instanceMessage":this.__privates._instanceMessageHandler(e);break;case"localStorageProxy":this.__privates._localStorageProxyHandler(e);break;case"backgroundMessage":this.__privates._backgroundPageMessageHandler(e);break;case"createLocalLogVariable":this.__privates._createLocalVariable(e)}},_connect:function(){var e,t,n=this;this.__privates._queue=[],this.__privates._sendMessage=function(e){n.__privates._queue.push(e)},this.__privates._isBackground||(this.__privates._port=(e=this.__privates._extensionId,t={name:JSON.stringify(this.__privates._secretKey)},"undefined"!=typeof browserAPI?browserAPI.runtime.connect(e,t):"chrome"in k?k.chrome.runtime.connect(e,t):null)),this.__privates._isBackground?this.__privates._port=self.handshake(this.__privates._id,this.__privates._secretKey,this.__privates._messageHandler.bind(this)):(this.__privates._port.onMessage.addListener(this.__privates._messageHandler.bind(this)),this.__privates._port.postMessage({id:this.__privates._id,key:this.__privates._secretKey,tabId:this.__privates._tabData.id}))},_saveLogValues:function(e){var t=v._helpers.specialJSON.toJSON.apply(v._helpers.specialJSON,[e,!0]),n=t.json,r=t.originalValues;return this.__privates._sentLogs.push({logObj:n,originalValues:r}),{data:JSON.stringify(n),logId:this.__privates._sentLogs.length-1}},_generateSendInstanceMessageFunction:function(n,r){var s=this;return function(e,t){s.__privates._sendInstanceMessage(n,r,e,t)}},_sendInstanceMessage:function(e,t,n,r){this.__privates._sendMessage({id:this.__privates._id,type:"sendInstanceMessage",data:{toInstanceId:e,toTabIndex:t,tabIndex:this.__privates._tabIndex,message:n,id:this.__privates._id,tabId:this.__privates._tabData.id},tabId:this.__privates._tabData.id,tabIndex:this.__privates._tabIndex,onFinish:{maxCalls:1,fn:function(e,t){r&&"function"==typeof r&&r("error"===e?{error:!0,success:!1,message:t}:{error:!1,success:!0})}}})},_updateCommHandlerStatus:function(e){this.__privates._sendMessage({id:this.__privates._id,type:"changeInstanceHandlerStatus",tabIndex:this.__privates._tabIndex,data:{tabIndex:this.__privates._tabIndex,hasHandler:e},tabId:this.__privates._tabData.id})},_storageListeners:null,_storagePrevious:{},_storagePreviousSync:{},_notifyChanges:function(t,e,n,r,s){var i;void 0===s&&(s=!1),i=Array.isArray(e)?e.join("."):e,this.__privates._storageListeners.forEach(function(e){e.type===t&&(e.key&&0!==e.key.indexOf(i)||v._helpers.isFn(e.callback)&&e.callback(i,n,r,s||!1))}),this.__privates._storagePrevious=this.__privates._nodeStorage},_localStorageChange:function(e,t,n,r){this.__privates._sendMessage({id:this.__privates._id,type:"updateStorage",data:{type:"nodeStorage",isSync:0===r,nodeStorageChanges:[{key:"string"==typeof e?e:e.join("."),oldValue:t,newValue:n}],id:this.__privates._id,tabIndex:this.__privates._tabIndex,tabId:this.__privates._tabData.id},tabIndex:this.__privates._tabIndex,tabId:this.__privates._tabData.id}),this.__privates._notifyChanges(r,e,t,n,!1)},_sendOptionalCallbackCrmMessage:function(t,i,n,a){var o=this;return void 0===a&&(a=!1),new Promise(function(r,s){var e={type:"crmapi",id:o.__privates._id,tabIndex:o.__privates._tabIndex,action:t,crmPath:o.__privates._node.path,data:n,onFinish:{persistent:a,maxCalls:1,fn:function(e,t,n){"error"===e?(o.onError&&o.onError(t),o.stackTraces&&setTimeout(function(){console.log("stack trace: "),n.forEach(function(e){console.log(e)})},5),o.errors?s(new Error("CrmAPIError: "+t.error)):console.warn("CrmAPIError: "+t.error)):(i&&i.apply(o,t),r(t[0]))}},tabId:o.__privates._tabData.id};o.__privates._sendMessage(e)})},_sendCrmMessage:function(n,r,s){var i=this;return void 0===s&&(s={}),new Promise(function(e,t){i.__privates._sendOptionalCallbackCrmMessage.call(i,n,r,s).then(e,t)})},_sendPromiseMessage:function(e,t){return void 0===t&&(t={}),this.__privates._sendOptionalCallbackCrmMessage.call(this,e,function(){},t)},_ensureBackground:function(){if(!this.__privates._isBackground)throw new Error("Attempting to use background-page function from non-background page");return!0},_wrapBrowserObject:function(t,s,i){void 0===i&&(i=[]);var a=this,o={},e=function(r){var e=t[r];if("object"==typeof e)o[r]=c._wrapBrowserObject(e,s,i.concat([r]));else if("function"==typeof e){var n=v._helpers.mergeObjects(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=new a._browserRequest(this,i.concat([r]).join("."))).args.apply(e,t)},{a:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.args.apply(this,e)},args:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=new a._browserRequest(this,i.concat([r]).join("."))).args.apply(e,t)},p:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.persistent.apply(this,e)},persistent:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=new a._browserRequest(this,i.concat([r]).join("."))).persistent.apply(e,t)},s:function(){return n.send.apply(this,[])},send:function(){return new a._browserRequest(this,i.concat([r]).join(".")).send()}});Object.defineProperty(n,"request",{get:function(){return new a._browserRequest(this,i.concat([r]).join(".")).request}}),o[r]=n}else o[r]=t[r]},c=this;for(var n in t)e(n);return o},_browserRequest:function(){function e(e,t,n){var r=this;this.__this=e;var s={api:t,chromeAPIArguments:[],_sent:!1};this.request=s,e.warnOnChromeFunctionNotSent&&k.setTimeout(function(){s._sent||console.warn("Looks like you didn't send your chrome function, set crmAPI.warnOnChromeFunctionNotSent to false to disable this message")},5e3),Object.defineProperty(s,"type",{get:function(){return n}});var i=v._helpers.mergeObjects(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.a.bind(r).apply(void 0,e)},{a:this.a.bind(this),args:this.args.bind(this),p:this.p.bind(this),persistent:this.persistent.bind(this),send:this.send.bind(this),s:this.s.bind(this),request:this.request});return this.returnedVal=i,this.returnedVal}return e.prototype.new=function(e,t,n){return this},e.prototype.args=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0;n<e.length;n++){var r=arguments[n];"function"==typeof r?this.request.chromeAPIArguments.push({type:"fn",isPersistent:!1,val:this.__this.__privates._createCallback(r,new Error,{maxCalls:1})}):this.request.chromeAPIArguments.push({type:"arg",val:v._helpers.jsonFn.stringify(r)})}return this.returnedVal},e.prototype.a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.args.apply(this,e)},e.prototype.persistent=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0;n<e.length;n++)this.request.chromeAPIArguments.push({type:"fn",isPersistent:!0,val:this.__this.__privates._createCallback(e[n],new Error,{persistent:!0})});return this.returnedVal},e.prototype.p=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.persistent.apply(this,e)},e.prototype.s=function(){return this.send()},e.prototype.send=function(){var o=this;return new Promise(function(s,i){var e=o;o.request._sent=!0;var t=0,n=!1;o.request.chromeAPIArguments.forEach(function(e){"fn"===e.type&&(t++,e.isPersistent&&(n=!0))});var r={maxCalls:t,persistent:n,fn:function(e,t,n){if("error"===e||"chromeError"===e)i(new Error(t.error));else{var r=t;r&&"number"==typeof r.callbackId?(o.__this.__privates._callInfo.get(r.callbackId).callback.apply(k,r.params),o.__this.__privates._callInfo.get(r.callbackId).persistent||o.__this.__privates._callInfo.remove(r.callbackId)):s(t)}}},a={type:"browser",id:o.__this.__privates._id,tabIndex:o.__this.__privates._tabIndex,api:e.request.api,args:e.request.chromeAPIArguments,tabId:o.__this.__privates._tabData.id,requestType:e.request.type,onFinish:r};o.__this.__privates._sendMessage(a)})},e}(),_chromeRequest:function(){function e(e,t,n){var r=this;this.__this=e;var s={api:t,chromeAPIArguments:[],_sent:!1};this.request=s,e.warnOnChromeFunctionNotSent&&k.setTimeout(function(){s._sent||console.warn("Looks like you didn't send your chrome function, set crmAPI.warnOnChromeFunctionNotSent to false to disable this message")},5e3),Object.defineProperty(s,"type",{get:function(){return n}});var i=v._helpers.mergeObjects(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.a.bind(r).apply(void 0,e)},{a:this.a.bind(this),args:this.args.bind(this),r:this.r.bind(this),return:this.return.bind(this),p:this.p.bind(this),persistent:this.persistent.bind(this),send:this.send.bind(this),s:this.s.bind(this),request:this.request});return this.returnedVal=i,this.returnedVal}return e.prototype.new=function(e,t,n){return this},e.prototype.args=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0;n<e.length;n++){var r=arguments[n];"function"==typeof r?this.request.chromeAPIArguments.push({type:"fn",isPersistent:!1,val:this.__this.__privates._createCallback(r,new Error,{maxCalls:1})}):this.request.chromeAPIArguments.push({type:"arg",val:v._helpers.jsonFn.stringify(r)})}return this.returnedVal},e.prototype.a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.args.apply(this,e)},e.prototype.return=function(e){return this.request.chromeAPIArguments.push({type:"return",val:this.__this.__privates._createCallback(e,new Error,{maxCalls:1})}),this.returnedVal},e.prototype.r=function(e){return this.return(e)},e.prototype.persistent=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0;n<e.length;n++)this.request.chromeAPIArguments.push({type:"fn",isPersistent:!0,val:this.__this.__privates._createCallback(e[n],new Error,{persistent:!0})});return this.returnedVal},e.prototype.p=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.persistent.apply(this,e)},e.prototype.send=function(){var i=this;this.request._sent=!0;var t=0,n=!1;this.request.chromeAPIArguments.forEach(function(e){"fn"!==e.type&&"return"!==e.type||(t++,e.isPersistent&&(n=!0))});var e={maxCalls:t,persistent:n,fn:function(e,t,n){if("error"===e||"chromeError"===e){var r=t;if(i.request.onError?i.request.onError(r):i.__this.onError&&i.__this.onError(r),i.__this.stackTraces&&k.setTimeout(function(){var e,t;t=n,(e=r).stackTrace&&(console.warn("Remote stack trace:"),e.stackTrace.split("\n").forEach(function(e){console.warn(e)})),console.warn((e.stackTrace?"Local s":"S")+"tack trace:"),t.forEach(function(e){console.warn(e)})},5),i.__this.errors)throw new Error("CrmAPIError: "+r.error);i.__this.onError||console.warn("CrmAPIError: "+r.error)}else{var s=t;i.__this.__privates._callInfo.get(s.callbackId).callback.apply(k,s.params),i.__this.__privates._callInfo.get(s.callbackId).persistent||i.__this.__privates._callInfo.remove(s.callbackId)}}},r={type:"chrome",id:this.__this.__privates._id,tabIndex:this.__this.__privates._tabIndex,api:this.request.api,args:this.request.chromeAPIArguments,tabId:this.__this.__privates._tabData.id,requestType:this.request.type,onFinish:e};return this.__this.__privates._sendMessage(r),this.returnedVal},e.prototype.s=function(){return this.send()},e}(),_specialRequest:function(e,t){return new this.__privates._browserRequest(this,e,t)},_setupRequestEvent:function(n,r,s){n["on"+s]&&r.addEventListener(s,function(e){var t={responseText:r.responseText,responseXML:r.responseXML,readyState:r.readyState,responseHeaders:null,status:null,statusText:null,finalUrl:null};switch(s){case"progress":t.lengthComputable=e.lengthComputable,t.loaded=e.loaded,t.total=e.total;break;case"error":break;default:if(4!==r.readyState)break;t.responseHeaders=r.getAllResponseHeaders(),t.status=r.status,t.statusText=r.statusText}n["on"+s](t)})},_addNotificationListener:function(e,t,n){this.__privates._sendMessage({id:this.__privates._id,type:"addNotificationListener",data:{notificationId:e,onClick:t,tabIndex:this.__privates._tabIndex,onDone:n,id:this.__privates._id,tabId:this.__privates._tabData.id},tabIndex:this.__privates._tabIndex,tabId:this.__privates._tabData.id})},_setGlobalFunctions:function(){var e=this.GM;for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];k[t]="function"==typeof n?n.bind(this):n}k.$=k.$||this.$crmAPI,k.log=k.log||this.log},_storageGet:function(e,t){var n=0===e?this.__privates._nodeStorageSync:this.__privates._nodeStorage;if(!t)return n;if(v._helpers.checkType(t,"string",!0)){var r=t;if("string"==typeof r){if(-1===r.indexOf("."))return n[r];t=r.split(".")}}return v._helpers.checkType(t,"array","keyPath"),Array.isArray(t)?v._helpers.lookup(t,n):void 0},_storageSet:function(e,t,n){var r=0===e?this.__privates._nodeStorageSync:this.__privates._nodeStorage;if(v._helpers.checkType(t,"string",!0)){var s=t;if("string"==typeof s){if(-1===s.indexOf("."))return this.__privates._localStorageChange(t,r[s],n,e),r[s]=n,void(0===e?this.__privates._storagePreviousSync=r:this.__privates._storagePrevious=r);t=s.split(".")}}if(v._helpers.checkType(t,"array",!0)){var i=t;if(Array.isArray(i)){for(var a=r,o=i.length-1,c=0;c<o;c++)void 0===a[i[c]]&&(a[i[c]]={}),a=a[i[c]];return this.__privates._localStorageChange(i,a[i[i.length-1]],n,1),a[i[i.length-1]]=n,void(0===e?this.__privates._storagePreviousSync=r:this.__privates._storagePrevious=r)}}v._helpers.checkType(t,["object"],"keyPath");var _=t;if("object"==typeof _)for(var u in _)_.hasOwnProperty(u)&&(this.__privates._localStorageChange(u,r[u],_[u],e),r[u]=_[u]);0===e?this.__privates._storagePreviousSync=r:this.__privates._storagePrevious=r},_storageRemove:function(e,t){var n=0===e?this.__privates._nodeStorageSync:this.__privates._nodeStorage;if(v._helpers.checkType(t,"string",!0)){var r=t;if("string"==typeof r){if(-1===r.indexOf("."))return this.__privates._notifyChanges(e,r,n[r],void 0),delete n[r],void(0===e?this.__privates._storagePreviousSync=n:this.__privates._storagePrevious=n);t=r.split(".")}}if(v._helpers.checkType(t,"array",!0)){var s=t;if(Array.isArray(s)){var i=v._helpers.lookup(s,n,!0);return this.__privates._notifyChanges(e,s.join("."),i[s[s.length-1]],void 0),delete i[s[s.length-1]],void(0===e?this.__privates._storagePreviousSync=n:this.__privates._storagePrevious=n)}}0===e?this.__privates._storagePreviousSync=n:this.__privates._storagePrevious=n},_addStorageOnChangeListener:function(e,t,n){return this.__privates._storageListeners.add({callback:t,type:e,key:n})},_removeStorageChangeListener:function(n,r,s){var i=this;"number"==typeof r?this.__privates._storageListeners.remove(r):this.__privates._storageListeners.forEach(function(e,t){e.callback===r&&e.type===n&&(void 0!==s?e.key===s&&i.__privates._storageListeners.remove(t):i.__privates._storageListeners.remove(t))})}},this.stackTraces=!0,this.errors=!0,this.debugOnerror=!1,this.lastError=void 0,this.onError=null,this.warnOnChromeFunctionNotSent=!0,this.comm={getInstances:function(r){var e=this;return new Promise(function(t){if(e.__privates._instancesReady){var n=[];e.__privates._instances.forEach(function(e){n.push(e)}),r&&r(n),t(n)}else e.__privates._instancesReadyListeners.push(function(e){r&&r(e),t(e)})})},sendMessage:function(e,n,r){var s;return(void 0!==r&&"function"!=typeof r&&"number"==typeof n||4===arguments.length)&&(n=r,r=arguments[3]),s="number"==typeof e?this.__privates._instances.get(e):e,new Promise(function(t){v._helpers.isFn(s.sendMessage)&&s.sendMessage(n,function(e){r&&r(e),t(e)})})},addListener:function(e){var t=this.__privates._commListeners.length,n=this.__privates._commListeners.add(e);return 0===t&&this.__privates._updateCommHandlerStatus(!0),n},removeListener:function(e){this.__privates._commListeners.remove(e),0===this.__privates._commListeners.length&&this.__privates._updateCommHandlerStatus(!1)},messageBackgroundPage:function(n,r){var s=this;return new Promise(function(t,e){s.__privates._isBackground?e("The function messageBackgroundPage is not available in background pages"):s.__privates._sendMessage({id:s.__privates._id,type:"sendBackgroundpageMessage",data:{message:n,id:s.__privates._id,tabId:s.__privates._tabData.id,tabIndex:s.__privates._tabIndex,response:s.__privates._createCallbackFunction(function(e){r(e),t(e)},new Error,{maxCalls:1})},tabIndex:s.__privates._tabIndex,tabId:s.__privates._tabData.id})})},listenAsBackgroundPage:function(e){this.__privates._isBackground?this.__privates._backgroundPageListeners.add(e):this.log("The function listenAsBackgroundPage is not available in non-background script")}},this.storage={get:function(e){return this.__privates._storageGet(1,e)},set:function(e,t){return this.__privates._storageSet(1,e,t)},remove:function(e){return this.__privates._storageRemove(1,e)},onChange:{addListener:function(e,t){return this.__privates._addStorageOnChangeListener(1,e,t)},removeListener:function(e,t){this.__privates._removeStorageChangeListener(1,e,t)}}},this.storageSync={get:function(e){return this.__privates._storageGet(0,e)},set:function(e,t){return this.__privates._storageSet(0,e,t)},remove:function(e){return this.__privates._storageRemove(0,e)},onChange:{addListener:function(e,t){return this.__privates._addStorageOnChangeListener(0,e,t)},removeListener:function(e,t){this.__privates._removeStorageChangeListener(0,e,t)}}},this.contextMenuItem={setType:function(e,t){return void 0===t&&(t=!1),this.__privates._sendPromiseMessage.call(this,"contextMenuItem.setType",{itemType:e,allTabs:t})},setChecked:function(e,t){return void 0===t&&(t=!1),this.__privates._sendPromiseMessage.call(this,"contextMenuItem.setChecked",{checked:e,allTabs:t})},setContentTypes:function(e,t){return void 0===t&&(t=!1),this.__privates._sendPromiseMessage.call(this,"contextMenuItem.setContentTypes",{contentTypes:e,allTabs:t})},setVisibility:function(e,t){return void 0===t&&(t=!1),this.__privates._sendPromiseMessage.call(this,"contextMenuItem.setVisibility",{isVisible:e,allTabs:t})},setDisabled:function(e,t){return void 0===t&&(t=!1),this.__privates._sendPromiseMessage.call(this,"contextMenuItem.setDisabled",{isDisabled:e,allTabs:t})},setName:function(e,t){return void 0===t&&(t=!1),this.__privates._sendPromiseMessage.call(this,"contextMenuItem.setName",{name:e,allTabs:t})},resetName:function(e){return void 0===e&&(e=!1),this.__privates._sendPromiseMessage.call(this,"contextMenuItem.resetName",{allTabs:e})}},this.crm={getRootContextMenuId:function(e){return this.__privates._sendCrmMessage("crm.getRootContextMenuId",e)},getTree:function(e){return this.__privates._sendCrmMessage("crm.getTree",e)},getSubTree:function(e,t){return this.__privates._sendCrmMessage("crm.getSubTree",t,{nodeId:e})},getNode:function(e,t){return this.__privates._sendCrmMessage("crm.getNode",t,{nodeId:e})},getNodeIdFromPath:function(e,t){return this.__privates._sendCrmMessage("crm.getNodeIdFromPath",t,{path:e})},queryCrm:function(e,t){return this.__privates._sendCrmMessage("crm.queryCrm",t,{query:e})},getParentNode:function(e,t){return this.__privates._sendCrmMessage("crm.getParentNode",t,{nodeId:e})},getNodeType:function(e,t){return this.__privates._sendCrmMessage("crm.getNodeType",t,{nodeId:e})},getNodeValue:function(e,t){return this.__privates._sendCrmMessage("crm.getNodeValue",t,{nodeId:e})},createNode:function(e,t){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.createNode",t,{options:e})},copyNode:function(e,t,n){void 0===t&&(t={});var r=JSON.parse(JSON.stringify(t));return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.copyNode",n,{nodeId:e,options:r})},moveNode:function(e,t,n){var r;return r=t?JSON.parse(JSON.stringify(t)):{},this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.moveNode",n,{nodeId:e,position:r})},deleteNode:function(e,t){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.deleteNode",t,{nodeId:e})},editNode:function(e,t,n){t=t||{};var r=JSON.parse(JSON.stringify(t));return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.editNode",n,{options:r,nodeId:e})},getTriggers:function(e,t){return this.__privates._sendCrmMessage("crm.getTriggers",t,{nodeId:e})},setTriggers:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.setTriggers",n,{nodeId:e,triggers:t})},getTriggerUsage:function(e,t){return this.__privates._sendCrmMessage("crm.getTriggerUsage",t,{nodeId:e})},setTriggerUsage:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.setTriggerUsage",n,{nodeId:e,useTriggers:t})},getContentTypes:function(e,t){return this.__privates._sendCrmMessage("crm.getContentTypes",t,{nodeId:e})},setContentType:function(e,t,n,r){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.setContentType",r,{index:t,value:n,nodeId:e})},setContentTypes:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.setContentTypes",n,{contentTypes:t,nodeId:e})},setLaunchMode:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.setLaunchMode",n,{nodeId:e,launchMode:t})},getLaunchMode:function(e,t){return this.__privates._sendCrmMessage("crm.getLaunchMode",t,{nodeId:e})},stylesheet:{setStylesheet:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.stylesheet.setStylesheet",n,{nodeId:e,stylesheet:t})},getStylesheet:function(e,t){return this.__privates._sendCrmMessage("crm.stylesheet.getStylesheet",t,{nodeId:e})}},link:{getLinks:function(e,t){return this.__privates._sendCrmMessage("crm.link.getLinks",t,{nodeId:e})},setLinks:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.link.setLinks",n,{nodeId:e,items:t})},push:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.link.push",n,{items:t,nodeId:e})},splice:function(e,t,n,r){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.link.splice",function(e){var t=e.spliced,n=e.newArr;r&&r(t,n)},{nodeId:e,start:t,amount:n})}},script:{setScript:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.script.setScript",n,{nodeId:e,script:t})},getScript:function(e,t){return this.__privates._sendCrmMessage("crm.script.getScript",t,{nodeId:e})},setBackgroundScript:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.script.setBackgroundScript",n,{nodeId:e,script:t})},getBackgroundScript:function(e,t){return this.__privates._sendCrmMessage("crm.script.getBackgroundScript",t,{nodeId:e})},libraries:{push:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.script.libraries.push",n,{nodeId:e,libraries:t})},splice:function(e,t,n,r){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.script.libraries.splice",function(e){var t=e.spliced,n=e.newArr;r&&r(t,n)},{nodeId:e,start:t,amount:n})}},backgroundLibraries:{push:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.script.backgroundLibraries.push",n,{nodeId:e,libraries:t})},splice:function(e,t,n,r){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.script.backgroundLibraries.splice",function(e){var t=e.spliced,n=e.newArr;r&&r(t,n)},{nodeId:e,start:t,amount:n})}}},menu:{getChildren:function(e,t){return this.__privates._sendCrmMessage("crm.menu.getChildren",t,{nodeId:e})},setChildren:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.menu.setChildren",n,{nodeId:e,childrenIds:t})},push:function(e,t,n){return Array.isArray(t)||(t=[t]),this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.menu.push",n,{nodeId:e,childrenIds:t})},splice:function(e,t,n,r){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.menu.splice",function(e){var t=e.spliced,n=e.newArr;r&&r(t,n)},{nodeId:e,start:t,amount:n})}}},this.background={runScript:function(e,t){if(this.__privates._ensureBackground())return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.background.runScript",null,{id:e,options:t},!0)},runSelf:function(e){if(this.__privates._ensureBackground())return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.background.runSelf",null,{options:e})},addKeyboardListener:function(e,t){if(this.__privates._ensureBackground())return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.background.addKeyboardListener",t,{key:e},!0)}},this.libraries={register:function(e,t,n){return this.__privates._sendOptionalCallbackCrmMessage.call(this,"crm.libraries.register",n,{name:e,url:t.url,code:t.code,ts:t.ts})}},this.browser=null,this.GM={GM_info:function(){return this.__privates._greasemonkeyData.info},GM_getValue:function(e,t){var n=f.storage.get(e);return void 0!==n?n:t},GM_setValue:function(e,t){this.storage.set(e,"object"==typeof t?JSON.parse(JSON.stringify(t)):t)},GM_deleteValue:function(e){this.storage.remove(e)},GM_listValues:function(){var e=[];for(var t in this.__privates._nodeStorage)this.__privates._nodeStorage.hasOwnProperty(t)&&e.push(t);return e},GM_getResourceURL:function(e){if(this.__privates._greasemonkeyData.resources[e])return this.__privates._greasemonkeyData.resources[e].crmUrl},GM_getResourceString:function(e){if(this.__privates._greasemonkeyData.resources[e])return this.__privates._greasemonkeyData.resources[e].dataString},GM_addStyle:function(e){var t=document.createElement("style");t.appendChild(document.createTextNode(e)),document.head.appendChild(t)},GM_log:console.log.bind(console),GM_openInTab:function(e){k.open(e,"_blank")},GM_registerMenuCommand:v._helpers.emptyFn,GM_unregisterMenuCommand:v._helpers.emptyFn,GM_setClipboard:v._helpers.emptyFn,GM_xmlhttpRequest:function(e){var t=new XMLHttpRequest;if(this.__privates._setupRequestEvent(e,t,"abort"),this.__privates._setupRequestEvent(e,t,"error"),this.__privates._setupRequestEvent(e,t,"load"),this.__privates._setupRequestEvent(e,t,"progress"),this.__privates._setupRequestEvent(e,t,"readystatechange"),t.open(e.method,e.url,!0,e.username||"",e.password||""),e.overrideMimeType&&t.overrideMimeType(e.overrideMimeType),e.headers)for(var n in e.headers)Object.prototype.hasOwnProperty.call(e.headers,n)&&t.setRequestHeader(n,e.headers[n]);var r=e.data?e.data:null;return t.send(r)},GM_addValueChangeListener:function(e,t){return this.__privates._storageListeners.add({key:e,type:1,callback:t})},GM_removeValueChangeListener:function(e){this.__privates._storageListeners.remove(e)},GM_download:function(e,t){var n={},r=e;"string"==typeof r?(n.url=r,n.name=t):n=e;var s={url:n.url,fileName:n.name,saveAs:t,headers:n.headers};this.__privates._specialRequest("downloads.download","GM_download").args(s).send().then(function(e){void 0===e.APIArgs[0]?v._helpers.isFn(n.onerror)&&n.onerror({error:"not_succeeded",details:"request didn't complete"}):v._helpers.isFn(n.onload)&&n.onload()}).catch(function(e){v._helpers.isFn(n.onerror)&&n.onerror({error:"not_permitted",details:e.error})})},GM_getTab:v._helpers.instantCb,GM_getTabs:v._helpers.instantCb,GM_saveTab:v._helpers.instantCb,unsafeWindow:void 0===k?self:k,GM_installScript:v._helpers.emptyFn,GM_notification:function(e,t,n,r){var s,i,a=this;(s="object"==typeof e&&e?{message:e.text,title:e.title,iconUrl:e.imageUrl,isClickable:!!e.onclick,onclick:e.onclick,ondone:e.ondone}:{message:e,title:t,iconUrl:n,isClickable:!!r,onclick:r}).type="basic",s.iconUrl=s.iconUrl||(i="icon-large.png","undefined"!=typeof browserAPI?browserAPI.runtime.getURL(i):"chrome"in k?k.chrome.runtime.getURL(i):i);var o=s.onclick&&this.__privates._createCallbackFunction(s.onclick,new Error,{maxCalls:1}),c=s.ondone&&this.__privates._createCallbackFunction(s.ondone,new Error,{maxCalls:1});delete s.onclick,delete s.ondone,this.__privates._specialRequest("notifications.create","GM_notification").args(s).s().then(function(e){a.__privates._addNotificationListener(e,o,c)}).catch(function(e){console.warn?console.warn(e):console.log(e)})}},this.$crmAPI=this.$,this.__privates._node=e,this.__privates._id=t,this.__privates._tabData=n,this.__privates._clickData=r,this.__privates._secretKey=s,this.__privates._nodeStorage=i,this.__privates._contextData=a,this.__privates._greasemonkeyData=o,this.__privates._isBackground=c,this.__privates._options=_,this.__privates._enableBackwardsCompatibility=u,this.__privates._tabIndex=l,this.__privates._extensionId=p,this.__privates._supportedAPIs=d,this.__privates._nodeStorageSync=h,this.tabId=n.id,this.currentTabIndex=l,this.permissions=JSON.parse(JSON.stringify(e.permissions||[])),this.id=t,this.isBackground=c,this.chromeAPISupported=-1<d.split(",").indexOf("chrome"),this.browserAPISupported=-1<d.split(",").indexOf("browser");var g=this.__privates;Object.defineProperty(this,"lastError",{get:function(){if(g._lastError)return g._lastError.checked=!0,g._lastError.err}}),this.__privates._findElementsOnPage.bind(this)(a),this.__privates._setupBrowserAPI(this)}var v,t;return(v=e).prototype._init=function(e){e||(m="undefined"==typeof localStorage?{}:localStorage),this.__privates._setupStorages(),this.__privates._setGlobalFunctions(),this.__privates._connect()},e.prototype.options=function(e){return v._helpers.mergeObjects(e||{},this.__privates._options)},e.prototype.onReady=function(t){if(0===k._crmAPIRegistry.length)t();else{var n=!1,r=k._crmAPIRegistry.pop.bind(k._crmAPIRegistry);k._crmAPIRegistry.pop=function(){var e=r();return 0===k._crmAPIRegistry.length&&(!n&&t&&t(),n=!0),e}}},e.prototype.getSelection=function(){return this.__privates._clickData.selectionText||k.getSelection()&&k.getSelection().toString()||""},e.prototype.getClickInfo=function(){return this.__privates._clickData},e.prototype.getTabInfo=function(){return this.__privates._tabData},e.prototype.getNode=function(){return this.__privates._node},e.prototype.chrome=function(e){return new this.__privates._chromeRequest(this,e)},e.prototype.fetch=function(r){return"fetch"in k&&void 0!==k.fetch?fetch(r).then(function(e){return e.text()}):new Promise(function(e,t){var n=new k.XMLHttpRequest;n.open("GET",r),n.onreadystatechange=function(){4===n.readyState&&(200<=n.status&&n.status<300?e(n.responseText):t(new Error("Failed xhr with status "+n.status)))},n.send()})},e.prototype.fetchBackground=function(e){var t=this;return new Promise(function(n,r){t.__privates._sendMessage({id:t.__privates._id,type:"fetch",tabId:t.__privates._tabData.id,tabIndex:t.__privates._tabIndex,data:{url:e,onFinish:t.__privates._createCallbackFunction(function(e,t){e?r(t):n(t)},new Error,{maxCalls:1}),id:t.__privates._id,tabIndex:t.__privates._tabIndex,tabId:t.__privates._tabData.id}})})},e.prototype.$=function(e,t){return void 0===t&&(t=document),Array.prototype.slice.apply(t.querySelectorAll(e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(new Error).stack.split("\n")[2];-1<n.indexOf("eval")&&(n=(new Error).stack.split("\n")[3]);var r=n.split("at"),s=r.slice(1,r.length).join("at").replace(/anonymous/,"script"),i=this.__privates._saveLogValues(e),a=i.data,o=i.logId;this.__privates._sendMessage({id:this.__privates._id,type:"logCrmAPIValue",tabId:this.__privates._tabData.id,tabIndex:this.__privates._tabIndex,data:{type:"log",data:JSON.stringify(a),id:this.__privates._id,logId:o,tabIndex:this.__privates._tabIndex,lineNumber:s,tabId:this.__privates._tabData.id}})},e._helpers=((t=function(){function e(){}return e.checkType=function(e,t,n){var r;if(r=Array.isArray(t)?t:[t],"boolean"==typeof n&&n)return null!=e&&(-1<r.indexOf(typeof e)&&!e.splice||-1<r.indexOf("array")&&"object"==typeof e&&e.splice);if(null==e)throw new Error("Value "+(n?"of "+n:"")+" is undefined or null");if(!(-1<r.indexOf(typeof e)&&!e.splice||-1<r.indexOf("array")&&"object"==typeof e&&e.splice))throw new Error("Value "+(n?"of "+n:"")+" is not of type"+(1<r.length?"s "+r.join(", "):" "+r));return!0},e.lookup=function(e,t,n){void 0===n&&(n=!1),this.checkType(e,"array","path"),this.checkType(t,"object","data");var r=e.length;n&&r--;for(var s=t,i=0;i<r;i++)s[e[i]]||i+1===r||(s[e[i]]={}),s=s[e[i]];return s},e.isFn=function(e){return e&&"function"==typeof e},e.mergeArrays=function(e,t){for(var n=0;n<t.length;n++)e[n]&&"object"==typeof t[n]&&void 0!==e[n]&&null!==e[n]?Array.isArray(t[n])?e[n]=this.mergeArrays(e[n],t[n]):e[n]=this.mergeObjects(e[n],t[n]):e[n]=t[n];return e},e.mergeObjects=function(e,t){for(var n in t)t.hasOwnProperty(n)&&("object"==typeof t[n]&&n in e?Array.isArray(t[n])?e[n]=this.mergeArrays(e[n],t[n]):e[n]=this.mergeObjects(e[n],t[n]):e[n]=t[n]);return e},e.instantCb=function(e){e()},e}()).jsonFn={stringify:function(e){return JSON.stringify(e,function(e,t){return t instanceof Function||"function"==typeof t?t.toString():t instanceof RegExp?"_PxEgEr_"+t:t})},parse:function(e,t){var r=!!t&&/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d *)?)Z$/;return JSON.parse(e,function(e,t){if("string"!=typeof t)return t;if(t.length<8)return t;var n=t.substring(0,8);return r&&t.match(r)?new Date(t):"function"===n?new Function(t):"_PxEgEr_"===n?new RegExp(t.slice(8)):t})}},t.specialJSON={_regexFlagNames:["global","multiline","sticky","unicode","ignoreCase"],_getRegexFlags:function(t){var n=[];return this._regexFlagNames.forEach(function(e){t[e]&&("sticky"===e?n.push("y"):n.push(e[0]))}),n},_stringifyNonObject:function(e){if("function"==typeof e){var t=e.toString(),n=this._fnRegex.exec(t);e="__fn$("+n[2]+"){"+n[10]+"}$fn__"}else e instanceof RegExp?e="__regexp$"+JSON.stringify({regexp:e.source,flags:this._getRegexFlags(e)})+"$regexp__":e instanceof Date?e="__date$"+e+"$date__":"string"==typeof e&&(e=e.replace(/\$/g,"\\$"));return JSON.stringify(e)},_fnRegex:/^(.|\s)*\(((\w+((\s*),?(\s*)))*)\)(\s*)(=>)?(\s*)\{((.|\n|\r)+)\}$/,_specialStringRegex:/^__(fn|regexp|date)\$((.|\n)+)\$\1__$/,_fnCommRegex:/^\(((\w+((\s*),?(\s*)))*)\)\{((.|\n|\r)+)\}$/,_parseNonObject:function(e){var t=JSON.parse(e);if("string"==typeof t){var n;if(!(n=this._specialStringRegex.exec(t)))return t.replace(/\\\$/g,"$");var r=n[2];switch(n[1]){case"fn":var s=this._fnCommRegex.exec(r);return""!==s[1].trim()?Function.apply(void 0,s[1].split(",").concat([s[6]])):new Function(s[6]);case"regexp":var i=JSON.parse(r);return new RegExp(i.regexp,i.flags.join(""));case"date":return new Date}}return t},_iterate:function(r,t,s){return Array.isArray(t)?(r=r||[],t.forEach(function(e,t,n){r[t]=s(e,t,n)})):(r=r||{},Object.getOwnPropertyNames(t).forEach(function(e){r[e]=s(t[e],e,t)})),r},_isObject:function(e){return!(e instanceof Date||e instanceof RegExp||e instanceof Function)&&("object"==typeof e&&!Array.isArray(e))},_toJSON:function(s,e,i,a){var o=this;if(this._isObject(e)||Array.isArray(e)){if(-1===a.originalValues.indexOf(e)){var t=a.refs.length;a.refs[t]=s,a.paths[t]=i,a.originalValues[t]=e}return s=this._iterate(s,e,function(e,t){if(o._isObject(e)||Array.isArray(e)){var n=void 0;if(-1===(n=a.originalValues.indexOf(e))){n=a.refs.length,s=Array.isArray(e)?[]:{},a.refs.push(null),a.paths[n]=i;var r=o._toJSON(s[t],e,i.concat(t),a);a.refs[n]=r.data,a.originalValues[n]=e}return"__$"+n+"$__"}return o._stringifyNonObject(e)}),Array.isArray(e)?{refs:a.refs,data:s,rootType:"array"}:{refs:a.refs,data:s,rootType:"object"}}return{refs:[],data:this._stringifyNonObject(e),rootType:"normal"}},toJSON:function(e,t,s){var i=this;void 0===t&&(t=!1),void 0===s&&(s=[]);var a=[[]],o=[e];if(this._isObject(e)||Array.isArray(e)){var c=Array.isArray(e)?[]:{};s.push(c),c=this._iterate(c,e,function(e,t){if(i._isObject(e)||Array.isArray(e)){var n=void 0;if(-1===(n=o.indexOf(e))){n=s.length,s.push(null);var r=i._toJSON(c[t],e,[t],{refs:s,paths:a,originalValues:o}).data;o[n]=e,a[n]=[t],s[n]=r}return"__$"+n+"$__"}return i._stringifyNonObject(e)});n={refs:s,data:c,rootType:Array.isArray(e)?"array":"object",paths:a};return{json:t?n:JSON.stringify(n),originalValues:o}}var n={refs:[],data:this._stringifyNonObject(e),rootType:"normal",paths:[]};return{json:t?n:JSON.stringify(n),originalValues:o}},_refRegex:/^__\$(\d+)\$__$/,_replaceRefs:function(e,s){var i=this;return this._iterate(e,e,function(e){var t;if(t=i._refRegex.exec(e)){var n=t[1],r=s[~~n];return r.parsed?r.ref:(r.parsed=!0,i._replaceRefs(r.ref,s))}return i._parseNonObject(e)}),e},fromJSON:function(e){var t=JSON.parse(e);t.refs=t.refs.map(function(e){return{ref:e,parsed:!1}});var n=t.refs;return"normal"===t.rootType?JSON.parse(t.data):(n[0].parsed=!0,this._replaceRefs(n[0].ref,n))}},t.CallbackStorage=function(){function e(){this.length=0,this.items={},this.index=0}return e.prototype._updateLength=function(){var e=0;this.forEach(function(){e++}),this.length=e},e.prototype.add=function(e){return this.items[++this.index]=e,this._updateLength(),this.index},e.prototype.remove=function(e){if("number"==typeof e||"string"==typeof e)delete this.items[~~e];else for(var t in this.items)this.items[t]===e&&delete this.items[t];this._updateLength()},e.prototype.get=function(e){return this.items[e]},e.prototype.forEach=function(e){for(var t in this.items)e(this.items[t],t)},e}(),t.emptyFn=function(){},t),__decorate([r],e.prototype,"__privates"),__decorate([r],e,"_helpers"),e=v=__decorate([n],e)}();k._crmAPIRegistry=k._crmAPIRegistry||[],k._crmAPIRegistry.push(e)}("undefined"==typeof window?self:window);